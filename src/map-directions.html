<html><head><link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/google-apis/google-maps-api.html">



</head><body><dom-module id="map-directions">
  <style>:host{display:block;}</style>
  <template>
    <google-maps-api api-key="[[apiKey]]" language="[[language]]" on-api-load="_mapApiLoaded"></google-maps-api>
    <div id="directionsPanel" hidden$="[[!directionsPanel]]">
  </div></template>
</dom-module>

<script>Polymer({is:"map-directions",properties:{apiKey:String,map:{type:Object,observer:"_mapChanged"},startAddress:{type:String,notify:!0,value:null},endAddress:{type:String,notify:!0,value:null},travelMode:{type:String,value:"DRIVING"},waypoints:{type:Array,value:function(){return[]}},transitOptions:{type:Object,notify:!0,value:function(){return{}}},language:{type:String,value:null},rendererOptions:{type:Object,value:function(){return{}}},response:{type:Object,observer:"_responseChanged",notify:!0},directionsPanel:{type:Boolean,value:!1},arrivalTime:{type:String,notify:!0},departureTime:{type:String,notify:!0},useArrival:{type:Boolean}},observers:["_route(startAddress, endAddress)","_setArrival(arrivalTime)","_setDeparture(departureTime)","_changeTime(useArrival)"],ready:function(){this._setDeparture(this.departureTime)},_setArrival:function(){this.transitOptions.departureTime&&delete this.transitOptions.departureTime,this.transitOptions.arrivalTime=moment(this.arrivalTime).toDate(),this._route()},_setDeparture:function(){this.transitOptions.arrivalTime&&delete this.transitOptions.arrivalTime,this.transitOptions.departureTime=moment(this.departureTime).toDate(),this._route()},_changeTime:function(e){e?this._setDeparture():this._setArrival()},_mapApiLoaded:function(){this._route()},_responseChanged:function(){this.directionsRenderer&&this.response&&this.directionsRenderer.setDirections(this.response)},_mapChanged:function(){this.map&&this.map instanceof google.maps.Map?(this.directionsRenderer||(this.directionsRenderer=new google.maps.DirectionsRenderer(this.rendererOptions)),this.directionsPanel&&this.directionsRenderer.setPanel(this.$.directionsPanel),this.directionsRenderer.setMap(this.map),this._responseChanged()):this.directionsRenderer&&(this.directionsRenderer.setMap(null),this.directionsRenderer=null)},_route:function(){if("undefined"!=typeof google&&"undefined"!=typeof google.maps&&this.startAddress&&this.endAddress){this.directionsService||(this.directionsService=new google.maps.DirectionsService);var e={origin:this.startAddress,destination:this.endAddress,travelMode:this.travelMode,waypoints:this.waypoints,transitOptions:this.transitOptions};this.directionsService.route(e,function(e,t){t==google.maps.DirectionsStatus.OK&&(this.response=e,this.fire("google-map-response",{response:e}))}.bind(this))}}});</script>
</body></html>