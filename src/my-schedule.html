<html><head><meta charset="UTF-8"><link rel="import" href="transit-app.html"></head><body><div hidden="" by-vulcanize=""><dom-module id="iron-flex" assetpath="../bower_components/iron-flex-layout/">
  <template>
    <style>.layout.horizontal,
      .layout.vertical{display:-ms-flexbox;display:-webkit-flex;display:flex;}.layout.inline{display:-ms-inline-flexbox;display:-webkit-inline-flex;display:inline-flex;}.layout.horizontal{-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;}.layout.vertical{-ms-flex-direction:column;-webkit-flex-direction:column;flex-direction:column;}.layout.wrap{-ms-flex-wrap:wrap;-webkit-flex-wrap:wrap;flex-wrap:wrap;}.layout.center,
      .layout.center-center{-ms-flex-align:center;-webkit-align-items:center;align-items:center;}.layout.center-justified,
      .layout.center-center{-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}.flex{-ms-flex:1 1 0.000000001px;-webkit-flex:1;flex:1;-webkit-flex-basis:0.000000001px;flex-basis:0.000000001px;}.flex-auto{-ms-flex:1 1 auto;-webkit-flex:1 1 auto;flex:1 1 auto;}.flex-none{-ms-flex:none;-webkit-flex:none;flex:none;}</style>
  </template>
</dom-module>


<dom-module id="iron-flex-reverse" assetpath="../bower_components/iron-flex-layout/">
  <template>
    <style>.layout.horizontal-reverse,
      .layout.vertical-reverse{display:-ms-flexbox;display:-webkit-flex;display:flex;}.layout.horizontal-reverse{-ms-flex-direction:row-reverse;-webkit-flex-direction:row-reverse;flex-direction:row-reverse;}.layout.vertical-reverse{-ms-flex-direction:column-reverse;-webkit-flex-direction:column-reverse;flex-direction:column-reverse;}.layout.wrap-reverse{-ms-flex-wrap:wrap-reverse;-webkit-flex-wrap:wrap-reverse;flex-wrap:wrap-reverse;}</style>
  </template>
</dom-module>


<dom-module id="iron-flex-alignment" assetpath="../bower_components/iron-flex-layout/">
  <template>
    <style>.layout.start{-ms-flex-align:start;-webkit-align-items:flex-start;align-items:flex-start;}.layout.center,
      .layout.center-center{-ms-flex-align:center;-webkit-align-items:center;align-items:center;}.layout.end{-ms-flex-align:end;-webkit-align-items:flex-end;align-items:flex-end;}.layout.baseline{-ms-flex-align:baseline;-webkit-align-items:baseline;align-items:baseline;}.layout.start-justified{-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;}.layout.center-justified,
      .layout.center-center{-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;}.layout.end-justified{-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;}.layout.around-justified{-ms-flex-pack:distribute;-webkit-justify-content:space-around;justify-content:space-around;}.layout.justified{-ms-flex-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;}.self-start{-ms-align-self:flex-start;-webkit-align-self:flex-start;align-self:flex-start;}.self-center{-ms-align-self:center;-webkit-align-self:center;align-self:center;}.self-end{-ms-align-self:flex-end;-webkit-align-self:flex-end;align-self:flex-end;}.self-stretch{-ms-align-self:stretch;-webkit-align-self:stretch;align-self:stretch;}.self-baseline{-ms-align-self:baseline;-webkit-align-self:baseline;align-self:baseline;}.layout.start-aligned{-ms-flex-line-pack:start;-ms-align-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;}.layout.end-aligned{-ms-flex-line-pack:end;-ms-align-content:flex-end;-webkit-align-content:flex-end;align-content:flex-end;}.layout.center-aligned{-ms-flex-line-pack:center;-ms-align-content:center;-webkit-align-content:center;align-content:center;}.layout.between-aligned{-ms-flex-line-pack:justify;-ms-align-content:space-between;-webkit-align-content:space-between;align-content:space-between;}.layout.around-aligned{-ms-flex-line-pack:distribute;-ms-align-content:space-around;-webkit-align-content:space-around;align-content:space-around;}</style>
  </template>
</dom-module>

<dom-module id="iron-flex-factors" assetpath="../bower_components/iron-flex-layout/">
  <template>
    <style>.flex,
      .flex-1{-ms-flex:1 1 0.000000001px;-webkit-flex:1;flex:1;-webkit-flex-basis:0.000000001px;flex-basis:0.000000001px;}.flex-2{-ms-flex:2;-webkit-flex:2;flex:2;}.flex-3{-ms-flex:3;-webkit-flex:3;flex:3;}.flex-4{-ms-flex:4;-webkit-flex:4;flex:4;}.flex-5{-ms-flex:5;-webkit-flex:5;flex:5;}.flex-6{-ms-flex:6;-webkit-flex:6;flex:6;}.flex-7{-ms-flex:7;-webkit-flex:7;flex:7;}.flex-8{-ms-flex:8;-webkit-flex:8;flex:8;}.flex-9{-ms-flex:9;-webkit-flex:9;flex:9;}.flex-10{-ms-flex:10;-webkit-flex:10;flex:10;}.flex-11{-ms-flex:11;-webkit-flex:11;flex:11;}.flex-12{-ms-flex:12;-webkit-flex:12;flex:12;}</style>
  </template>
</dom-module>


<dom-module id="iron-positioning" assetpath="../bower_components/iron-flex-layout/">
  <template>
    <style>.block{display:block;}[hidden]{display:none !important;}.invisible{visibility:hidden !important;}.relative{position:relative;}.fit{position:absolute;top:0;right:0;bottom:0;left:0;}body.fullbleed{margin:0;height:100vh;}.scroll{-webkit-overflow-scrolling:touch;overflow:auto;}.fixed-bottom,
      .fixed-left,
      .fixed-right,
      .fixed-top{position:fixed;}.fixed-top{top:0;left:0;right:0;}.fixed-right{top:0;right:0;bottom:0;}.fixed-bottom{right:0;bottom:0;left:0;}.fixed-left{top:0;bottom:0;left:0;}</style>
  </template>
</dom-module>
</div><dom-module id="my-schedule">

  <template>
    <style is="schedule-style" include="iron-flex iron-flex-alignment">:host{display:block;padding:10px;--paper-tab-content:{background-color:cadetblue;};--paper-tabs-selection-bar-color:white;--paper-tabs:{border-radius:5%;};}.card{box-shadow:0 2px 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);padding:16px;margin:24px;border-radius:5px;background-color:#fff;color:#757575;}h1{font-size:22px;margin:16px 0;color:#212121;}*[hidden]{display:none !important;}.flex > *{margin-bottom:20px;}paper-tab{width:100px;color:black;}table{border-collapse:collapse;border-spacing:0;background-color:white;line-height:1em;font-size:8pt;color:black;}td{border:1px solid lightgrey;text-align:center;font-size:6pt;padding:3px;}tbody tr td:nth-child(odd){background-color:#ccc;}th.rotate{height:140px;white-space:nowrap;}th.rotate > div{transform:translate(25px, 51px)
         rotate(315deg);width:30px;}th.rotate > div > span{border-top:1px solid #ccc;border-bottom:1px solid #ccc;padding:5px 10px;}.scrollableTable{height:300px;overflow:auto;}</style>

    <div class="card flex layout vertical center center-justified wrap">
      <h1>Train Schedules</h1>
      <br>
      <paper-dropdown-menu label="Route">
        <paper-listbox class="dropdown-content" selected="{{route}}" attr-for-selected="name" aria-label="Route Selector">
          <paper-item name="blue">Blue Line</paper-item>
          <paper-item name="green">Green Line</paper-item>
          <paper-item name="northstar">Northstar</paper-item>
        </paper-listbox>
      </paper-dropdown-menu>

      <div class="flex layout center horizontal around-justified wrap self-stretch" hidden$="[[!_routePicked]]">
        <paper-tabs label="Direction" selected="{{direction}}" attr-for-selected="name">
          <paper-tab hidden$="[[!_showNS]]" name="N">North</paper-tab>
          <paper-tab hidden$="[[!_showNS]]" name="S">South</paper-tab>
          <paper-tab hidden$="[[_showNS]]" name="E">East</paper-tab>
          <paper-tab hidden$="[[_showNS]]" name="W">West</paper-tab>
        </paper-tabs>

        <paper-tabs label="Day" selected="{{day}}" attr-for-selected="name">
          <paper-tab name="Weekday">Weekday</paper-tab>
          <paper-tab name="Saturday">Saturday</paper-tab>
          <paper-tab name="Sunday">Sunday</paper-tab>
        </paper-tabs>
      </div>

      <section hidden$="[[!scheduleLoaded]]">
        <div class="scrollableTable">
          <table border="0" cell-padding="0" cell-spacing="0">
            <thead>
              <tr>
                <template is="dom-repeat" items="[[titles]]" as="title">
                  <th class="rotate"><div><span>[[title]]</span></div></th>
                </template>
              </tr>
            </thead>
            <tbody>
              <template is="dom-repeat" items="[[schedules]]" as="schedule">
                <tr>
                  <template is="dom-repeat" items="[[schedule]]" as="time">
                    <td>[[time]]</td>
                  </template>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </section>
    </div>

  </template>

  <script>

   Polymer({

     is: 'my-schedule',

     properties: {
       route: {
         type: String,
         notify: true
       },

       _routePicked: {
         type: Boolean,
         value: false
       },

       /**
        * Whether to show North/South or East/West directions, true shows North/South
        */
       _showNS: {
         type: Boolean
       },

       /**
        * The trip direction: N,S,E, or W
        */
       direction: {
         type: String,
         notify: true
       },

       _directionPicked: {
         type: Boolean
       },

       day: {
         type: String,
         notify: true,
         value: function() {
           return "Weekday";
         }
       },

       /**
        * Stations that match the given route and direction info
        */
       filteredStations: {
         type: Array,
         notify: true
       },

       titles: {
         type: Array,
         notify: true
       },

       schedules: {
         type: Array,
         notify: true
       },

       scheduleLoaded: {
         type: Boolean,
         value: false
       }
     },

     observers: [
       'displayDirection(route)',
       'filterStations(route, direction)',
       'fetchSchedule(route, direction, day)'
     ],

     /**
      * Show North/South or East/West directions depending on the route
      * @param {String} route The train route selected
      */
     displayDirection: function(route) {
       if (route == "green") {
         this.direction = "E";
         this._showNS = false;
       } else {
         this.direction = "N";
         this._showNS = true;
       }

       this._routePicked = true;
     },


     filterStations: function(route, direction) {
       var stations = app.stations.filter(s => {
         return s.route == route && s.direction == direction;
       });

       this.filteredStations = app.listStations(stations);
       this._directionPicked = true;
     },

     largestSubVec: function(coll) {
       return coll.reduce((n, arr) => {
         var size = arr.length;
         return n > size? n : size;
       });
     },

     flip2dArray: function(coll) {
       var i, j,
           arr = [],
           subarray = [],
           maxSize = this.largestSubVec(coll);

       for (i = 0; i < maxSize; i++) {
         for (j = 0; j < coll.length; j++) {
           var x = coll[j][i] || "-";
           subarray.push(x);
         };

         arr.push(subarray);
         subarray = [];
       };

       return arr;
     },

     // TODO: convert army time to 12 hr fmt
     // TODO: double-check target field platform 1 times
     fetchSchedule: function(route, direction, day) {
       var data = this.scheduleData,
           matched = app.stations.filter(s => {
             return s.direction == direction && s.route == route;
           });

       matched.sort(function(a, b) {
         var pos1 = a.position,
             pos2 = b.position;

         if (pos1 < pos2)
           return -1;
         if (pos1 > pos2)
           return 1;
         return 0;
       });

       this.titles = matched.map(s => {
         return s.title;
       });

       var schedules = matched.map(s => {
         var id = s.id;
         return data[id][day];
       });

       this.schedules = this.flip2dArray(schedules);

       this.scheduleLoaded = true;
     }
   });

  </script>

</dom-module>
</body></html>